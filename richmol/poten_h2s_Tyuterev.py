""" Potential energy surface of H2S molecule from our good friend Vladimir Tyuterev
"""
import numpy as np
import os.path
from ctypes import c_int

dll_path = os.path.join(os.path.dirname(__file__), 'poten_xy2_Tyuterev')
dll = np.ctypeslib.load_library('poten_xy2_tyuterev', dll_path)

# Parameters of the PES function 'poten' for H2S molecule
params = [
    ["re12",       1.3359007],
    ["aa1",        1.70400000],
    ["alphae",    92.265883],
    ["b1"  ,       0.80000000000000E+06],
    ["b2"  ,       0.80000000000000E+05],
    ["g1"  ,       0.13000000000000E+02],
    ["g2"  ,       0.55000000000000E+01],
    ["f000",       0.00000000000000E+00],
    ["f001",       0.25298724728304E+01],
    ["f100",       0.76001446034650E+01],
    ["f002",       0.19119869561968E+05],
    ["f101",      -0.26337942369521E+04],
    ["f110",      -0.34641383728936E+03],
    ["f200",       0.37146640335080E+05],
    ["f003",       0.10372456946123E+04],
    ["f102",      -0.48366811961179E+04],
    ["f111",       0.31178979423415E+04],
    ["f201",      -0.12711176182111E+04],
    ["f210",      -0.18726215609860E+03],
    ["f300",      -0.11796148983875E+04],
    ["f004",       0.47473763424544E+04],
    ["f103",      -0.13610350468586E+04],
    ["f112",       0.29144380025635E+04],
    ["f202",      -0.50653357937930E+04],
    ["f211",      -0.11097146714230E+04],
    ["f220",       0.10375282984635E+03],
    ["f301",       0.48047328722297E+04],
    ["f310",      -0.14060018110572E+03],
    ["f400",       0.22425353263397E+04],
    ["f005",       0.17914500029660E+04],
    ["f104",      -0.98184202293571E+03],
    ["f113",       0.61294305063749E+02],
    ["f203",      -0.27151696719548E+04],
    ["f212",       0.26119013667838E+04],
    ["f221",      -0.61703073530707E+04],
    ["f302",      -0.48833736184025E+04],
    ["f311",       0.10049289144454E+04],
    ["f320",       0.28708061338852E+03],
    ["f401",       0.67852017509792E+04],
    ["f410",      -0.10489708631647E+04],
    ["f500",       0.74727382498639E+03],
    ["f006",       0.20496523413380E+04],
    ["f105",       0.24807517966824E+03],
    ["f114",      -0.19578362789532E+04],
    ["f204",       0.70166633265091E+02],
    ["f213",       0.51823676755422E+04],
    ["f222",      -0.29736603824162E+04],
    ["f303",      -0.39068887749886E+04],
    ["f312",       0.22707809418082E+04],
    ["f321",       0.23793551966211E+05],
    ["f330",      -0.34932314882947E+04],
    ["f402",       0.85923207392547E+03],
    ["f411",      -0.11327987267957E+05],
    ["f420",       0.37668571305335E+03],
    ["f501",      -0.15953549707091E+05],
    ["f510",       0.14890386471456E+04],
    ["f600",       0.51484402685677E+03],
    ["f007",      -0.54617014746870E+04],
    ["f106",      -0.69943515992635E+02],
    ["f115",       0.17427705522754E+04],
    ["f205",       0.29147560120520E+03],
    ["f214",      -0.33646004327917E+04],
    ["f223",      -0.11202273117182E+04],
    ["f304",      -0.38323335633188E+03],
    ["f313",       0.26441151817245E+04],
    ["f322",       0.19366049577246E+04],
    ["f331",       0.38175718811604E+04],
    ["f403",       0.30778367811357E+04],
    ["f412",      -0.26353881747532E+04],
    ["f421",       0.83999500575225E+04],
    ["f430",      -0.52450951528119E+04],
    ["f502",      -0.34729416630406E+03],
    ["f511",      -0.50050684462558E+04],
    ["f520",      -0.28211904320344E+04],
    ["f601",      -0.10580696087439E+05],
    ["f610",       0.53782996209764E+04],
    ["f700",      -0.99734750908249E+03],
    ["f008",      -0.74046834718425E+03],
    ["f107",       0.00000000000000E+00],
    ["f116",       0.00000000000000E+00],
    ["f206",       0.00000000000000E+00],
    ["f215",       0.00000000000000E+00],
    ["f224",       0.00000000000000E+00],
    ["f305",       0.00000000000000E+00],
    ["f314",       0.00000000000000E+00],
    ["f323",       0.00000000000000E+00],
    ["f332",       0.00000000000000E+00],
    ["f404",       0.00000000000000E+00],
    ["f413",       0.00000000000000E+00],
    ["f422",       0.00000000000000E+00],
    ["f431",       0.00000000000000E+00],
    ["f440",       0.00000000000000E+00],
    ["f503",       0.00000000000000E+00],
    ["f512",       0.00000000000000E+00],
    ["f521",       0.00000000000000E+00],
    ["f530",       0.00000000000000E+00],
    ["f602",       0.00000000000000E+00],
    ["f611",       0.00000000000000E+00],
    ["f620",       0.00000000000000E+00],
    ["f701",       0.00000000000000E+00],
    ["f710",       0.00000000000000E+00],
    ["f800",       0.00000000000000E+00]]

def poten(coords):
    r1 = np.asfortranarray(coords[:,0])
    r2 = np.asfortranarray(coords[:,1])
    alpha = np.asfortranarray(coords[:,2])

    npoints = coords.shape[0]
    npoints_c = c_int(npoints)
    nparams_c = c_int(len(params))
    params_c = np.asfortranarray([p[1] for p in params])
    v = np.asfortranarray(np.zeros(npoints, dtype=np.float64))
    dll.poten.argtypes = [ \
            c_int,
            c_int,
            np.ctypeslib.ndpointer(np.float64, ndim=1, flags='F'), \
            np.ctypeslib.ndpointer(np.float64, ndim=1, flags='F'), \
            np.ctypeslib.ndpointer(np.float64, ndim=1, flags='F'), \
            np.ctypeslib.ndpointer(np.float64, ndim=1, flags='F'), \
            np.ctypeslib.ndpointer(np.float64, ndim=1, flags='F') ]
    dll.poten.restype = None
    dll.poten(npoints_c, nparams_c, r1, r2, alpha, params_c, v)
    return v
